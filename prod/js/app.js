"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();window.onload=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise(function(r,o){var i=t.collection,u=t.next_href,a=[].concat(_toConsumableArray(n),_toConsumableArray(i));u?fetch(u).then(function(e){return e.json()}).then(function(t){return r(e(t,a))}):r(a)})}function t(t,n){var a=new Promise(function(e,r){fetch("https://api.soundcloud.com/users/"+n+"?client_id="+t).catch(function(e){u("clientId"),r(e)}).then(function(e){return 404===e.status&&(u("username"),r()),e.json()}).then(function(t){t&&(f.classList.add("Form_Submit--loading"),e(t.id))})}),c=new Promise(function(n,r){a.then(function(e){return fetch("https://api.soundcloud.com/users/"+e+"/followings?client_id="+t+"&page_size=200&linked_partitioning=1")}).then(function(e){return e.json()}).then(function(t){return n(e(t))})}),s=new Promise(function(n,r){a.then(function(e){return fetch("https://api.soundcloud.com/users/"+e+"/favorites?client_id="+t+"&page_size=200&linked_partitioning=1")}).then(function(e){return e.json()}).then(function(t){return n(e(t))})});Promise.all([c,s]).then(function(e){var t=_slicedToArray(e,2),n=t[0],u=t[1],a=r(n),c=o(u),s="username, description, first_name, last_name, website_title, website, permalink\n"+h(a),l="username, title, created_at, description,  bpm, duration (ms), liked_count, kind, play_count, purchase_title, purchase_url, tag_list, permalink\n"+h(c),m=new File([s],"following.csv",{type:"text.csv"}),d=new File([l],"likes.csv",{type:"text.csv"});p.href=URL.createObjectURL(d),_.href=URL.createObjectURL(m),i(),ga("send","event","Results","Delivered")})}function n(e){return"string"==typeof e?e.replace(/[\n\r,]/g,". "):"number"==typeof e?e.toString():e}function r(e){return e.map(function(e){var t=e.description;return[e.username,t,e.first_name,e.last_name,e.website_title,e.website,e.permalink]})}function o(e){return e.map(function(e){var t=e.bpm,n=e.created_at,r=e.description,o=e.duration,i=e.favoritings_count,u=e.kind,a=e.playback_count,c=e.purchase_title,s=e.purchase_url,l=e.permalink,m=e.tag_list,d=e.title;return[e.user.username,d,n,r,t,o,i,u,a,c,s,m,l]})}function i(){f.classList.add("Form_Submit--hide"),setTimeout(function(){return f.classList.add("Form_Submit--none")},410),setTimeout(function(){p.classList.toggle("Download--visible"),_.classList.toggle("Download--visible")},450)}function u(e){"clientId"===e?(ga("send","event","Results","Failed - Client ID"),m.textContent="Incorrect Client ID",s.classList.add("Form_Input--error")):"username"===e&&(ga("send","event","Results","Failed - Username"),d.textContent="Username not found",l.classList.add("Form_Input--error"))}function a(){m.textContent="",d.textContent="",s.classList.remove("Form_Input--error"),l.classList.remove("Form_Input--error")}var c=document.querySelector("form"),s=document.querySelector(".Form_Input--clientId"),l=document.querySelector(".Form_Input--username"),m=document.querySelector(".Form_Error--clientId"),d=document.querySelector(".Form_Error--username"),f=document.querySelector(".Form_Submit"),p=document.querySelector(".Download--likes"),_=document.querySelector(".Download--following");c.addEventListener("submit",function(e){e.preventDefault(),ga("send","event","Submit Button","Click"),a(),t(s.value,l.value)});var h=function(e){return e.map(function(e){return e.map(function(e){return n(e)}).join(",")}).join("\n")}};