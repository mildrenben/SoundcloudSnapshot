"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(r=(u=s.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();window.onload=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise(function(r,o){var i=t.collection,u=t.next_href,s=[].concat(_toConsumableArray(n),_toConsumableArray(i));u?fetch(u).then(function(e){return e.json()}).then(function(t){return r(e(t,s))}):r(s)})}function t(t,n){var s=new Promise(function(e,r){fetch("https://api.soundcloud.com/users/"+n+"?client_id="+t).catch(function(e){u("clientId"),r(e)}).then(function(e){return 404===e.status&&(u("username"),r()),e.json()}).then(function(t){t.id&&(f.classList.add("Form_Submit--loading"),e(t.id))})}),a=new Promise(function(n,r){s.then(function(e){return fetch("https://api.soundcloud.com/users/"+e+"/followings?client_id="+t+"&page_size=200&linked_partitioning=1")}).then(function(e){return e.json()}).then(function(t){return n(e(t))})}),c=new Promise(function(n,r){s.then(function(e){return fetch("https://api.soundcloud.com/users/"+e+"/favorites?client_id="+t+"&page_size=200&linked_partitioning=1")}).then(function(e){return e.json()}).then(function(t){return n(e(t))})});Promise.all([a,c]).then(function(e){var t=_slicedToArray(e,2),n=t[0],u=t[1],s=r(n),a=o(u),c="username, description, first_name, last_name, website_title, website, permalink\n"+h(s),l="username, title, created_at, description,  bpm, duration (ms), liked_count, kind, play_count, purchase_title, purchase_url, tag_list, permalink\n"+h(a),d=new File([c],"following.csv",{type:"text.csv"}),m=new File([l],"likes.csv",{type:"text.csv"});p.href=URL.createObjectURL(m),_.href=URL.createObjectURL(d),i(),ga("send","event","Results","Delivered")})}function n(e){return"string"==typeof e?e.replace(/[\n\r,]/g,". "):"number"==typeof e?e.toString():e}function r(e){return e.map(function(e){var t=e.description;return[e.username,t,e.first_name,e.last_name,e.website_title,e.website,e.permalink]})}function o(e){return e.map(function(e){var t=e.bpm,n=e.created_at,r=e.description,o=e.duration,i=e.favoritings_count,u=e.kind,s=e.playback_count,a=e.purchase_title,c=e.purchase_url,l=e.permalink,d=e.tag_list,m=e.title;return[e.user.username,m,n,r,t,o,i,u,s,a,c,d,l]})}function i(){f.classList.add("Form_Submit--hide"),setTimeout(function(){return f.classList.add("Form_Submit--none")},410),setTimeout(function(){p.classList.toggle("Download--visible"),_.classList.toggle("Download--visible"),v.classList.add("Form_Info--visible")},450)}function u(e){"clientId"===e?(ga("send","event","Results","Failed - Client ID"),d.textContent="Incorrect Client ID",c.classList.add("Form_Input--error")):"username"===e&&(ga("send","event","Results","Failed - Username"),m.textContent="Username not found",l.classList.add("Form_Input--error"))}function s(){d.textContent="",m.textContent="",c.classList.remove("Form_Input--error"),l.classList.remove("Form_Input--error")}var a=document.querySelector("form"),c=document.querySelector(".Form_Input--clientId"),l=document.querySelector(".Form_Input--username"),d=document.querySelector(".Form_Error--clientId"),m=document.querySelector(".Form_Error--username"),f=document.querySelector(".Form_Submit"),p=document.querySelector(".Download--likes"),_=document.querySelector(".Download--following"),v=document.querySelector(".Form_Info");a.addEventListener("submit",function(e){e.preventDefault(),ga("send","event","Submit Button","Click"),s();var n=l.value.startsWith("https://soundcloud.com/")?l.value.substr(23):l.value;t(c.value,n)});var h=function(e){return e.map(function(e){return e.map(function(e){return n(e)}).join(",")}).join("\n")}};